@model Sewa360.Areas.Admin.Models.Partner

@{
    bool isEdit = Model != null && Model.Partner_Id > 0;
    string pageTitle = isEdit ? "Update Member" : "Register a New Member";
    string submitButtonText = isEdit ? "Update" : "Register";
    Layout = null;
}
@* 
@{
    bool isEdit = Model != null && Model.Id > 0;
    string pageTitle = isEdit ? "Update Member" : "Register a New Member";
    string submitButtonText = isEdit ? "Update" : "Register";
}
 *@
@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show text-center" role="alert" id="successMessage">
        <strong><i class="bi bi-check-circle-fill"></i>@TempData["Success"]</strong>
        @* <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button> *@
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show text-center" role="alert" id="errorMessage">
        <strong><i class="bi bi-exclamation-triangle-fill"></i>@TempData["Error"]</strong>

        @* <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button> *@
    </div>
}

<script>
    // Auto-hide success/error messages after 5 seconds
    setTimeout(function () {
        var successMsg = document.getElementById('successMessage');
        var errorMsg = document.getElementById('errorMessage');

        if (successMsg) {
            successMsg.classList.remove('show');
            successMsg.classList.add('fade');
            setTimeout(() => successMsg.style.display = 'none', 500);
        }

        if (errorMsg) {
            errorMsg.classList.remove('show');
            errorMsg.classList.add('fade');
            setTimeout(() => errorMsg.style.display = 'none', 500);
        }
    }, 3000);
</script>



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Groit Admin</title>
    <link rel="stylesheet" href="~/template2/vendors/iconfonts/font-awesome/css/all.min.css">
    <link rel="stylesheet" href="~/template2/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="~/template2/vendors/css/vendor.bundle.addons.css">
    <link rel="stylesheet" href="~/template2/css/style.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <link rel="shortcut icon" href="~/template2/images/favicon.png" />

    <style>
        .validation-msg {
            min-height: 1rem;
            font-size: 0.875rem;
            margin-top: 2px;
            display: block;
        }
    </style>

</head>

<body>
    <div class="container-scroller">
        <div class="container-fluid page-body-wrapper full-page-wrapper">
            <div class="content-wrapper d-flex align-items-stretch auth auth-img-bg">
                <div class="row flex-grow">
                    <div class="col-lg-6 d-flex align-items-center justify-content-center">
                        <div class="auth-form-transparent text-left p-3">
                            <h5>Groit</h5>
                            <h4 class="text-center font-weight-bold mb-4 text-primary text-nowrap">
                                @pageTitle
                            </h4>

                            @using (Html.BeginForm("PartnerRegisterForm", "Partner", FormMethod.Post))
                            {
                                @Html.AntiForgeryToken()

                                <div class="form-group">
                                    <label>First Name</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                            <span class="input-group-text bg-transparent border-right-0">
                                                <i class="fa fa-user text-primary"></i>
                                            </span>
                                        </div>
                                        @Html.TextBoxFor(m => m.First_Name, new { @class = "form-control form-control-lg border-left-0", @placeholder = "First Name*", @required = "required", id = "firstName" })
                                    </div>
                                    @Html.ValidationMessageFor(m => m.First_Name, "", new { @class = "text-danger validation-msg" })
                                </div>

                                <div class="form-group">
                                    <label>Last Name</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                            <span class="input-group-text bg-transparent border-right-0">
                                                <i class="fa fa-user text-primary"></i>
                                            </span>
                                        </div>
                                        @Html.TextBoxFor(m => m.Last_Name, new { @class = "form-control form-control-lg border-left-0", placeholder = "Last Name", id = "lastName" })
                                    </div>
                                    @Html.ValidationMessageFor(m => m.Last_Name, "", new { @class = "text-danger validation-msg" })
                                </div>

                                <div class="form-group">
                                    <label>Email</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                            <span class="input-group-text bg-transparent border-right-0">
                                                <i class="far fa-envelope-open text-primary"></i>
                                            </span>
                                        </div>
                                        @Html.TextBoxFor(m => m.Partner_Email, new { @class = "form-control form-control-lg border-left-0", placeholder = "Email*", type = "email", @required = "required", id = "emailField" })
                                    </div>
                                    @Html.ValidationMessageFor(m => m.Partner_Email, "", new { @class = "text-danger validation-msg" })
                                </div>

                                <div class="form-group">
                                    <label>Password</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                            <span class="input-group-text bg-transparent border-right-0">
                                                <i class="fa fa-lock text-primary"></i>
                                            </span>
                                        </div>
                                        @Html.PasswordFor(m => m.Partner_Password, new { @class = "form-control form-control-lg border-left-0", placeholder = "Password*", @required = "required", @id = "txtPassword" })
                                        <div class="pre-icon os-icon os-icon-fingerprint"></div>

                                        <i id="open" class="fa fa-eye" style="position:absolute; top: 20px; right: 20px; cursor:pointer;"></i>
                                        <i id="closed" class="fa fa-eye-slash" style="position:absolute; top: 20px; right: 20px; cursor:pointer; display:none;"></i>


                                    </div>
                                    @Html.ValidationMessageFor(m => m.Partner_Password, "", new { @class = "text-danger validation-msg" })
                                </div>

                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                            <span class="input-group-text bg-transparent border-right-0">
                                                <i class="fa fa-phone text-primary"></i>
                                            </span>
                                        </div>
                                        @Html.TextBoxFor(m => m.Partner_Phone, new { @class = "form-control form-control-lg border-left-0", placeholder = "Phone Number*", @required = "required" })
                                    </div>
                                    @Html.ValidationMessageFor(m => m.Partner_Phone, "", new { @class = "text-danger validation-msg" })
                                </div>

                                <div class="form-group">
                                    <label>Referral Code</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                            <span class="input-group-text bg-transparent border-right-0">
                                                <i class="fa fa-gift text-primary"></i>
                                            </span>
                                        </div>
                                        @Html.TextBoxFor(m => m.Manager_Code, new { @class = "form-control form-control-lg border-left-0", placeholder = "Referral Code*", @required = "required", id = "ManagerCode", name = "ManagerCode" })
                                    </div>

                                    <div class="form-group">
                                        <label id="managerNameLabel" class="text-primary font-weight-bold" style="display: none;">
                                            Manager: <span id="managerNameText"></span>
                                        </label>
                                    </div>


                                    @Html.ValidationMessageFor(m => m.Manager_Code, "", new { @class = "text-danger validation-msg" })
                                </div>

                                <!-- ✅ New Business Field -->
                                <div class="form-group">
                                    <label>Business</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend bg-transparent">
                                            <span class="input-group-text bg-transparent border-right-0">
                                                <i class="mdi mdi-briefcase text-primary"></i> <!-- Business icon -->
                                            </span>
                                        </div>
                                        @Html.TextBoxFor(m => m.Business, new
                                            {
                                                @class = "form-control form-control-lg border-left-0",
                                                placeholder = "Business Name*",
                                                required = "required",
                                                id = "Business",
                                                name = "Business"
                                            })
                                    </div>
                                    @Html.ValidationMessageFor(m => m.Business, "", new { @class = "text-danger validation-msg" })
                                </div>

                             @*    <div class="form-group">
                                    <label for="ManagerCode">Referral Code (Manager Code)</label>
                                    <input type="text" id="ManagerCode" name="ManagerCode" class="form-control" />
                                </div>

                                <div class="form-group">
                                    <label id="managerNameLabel" class="text-primary font-weight-bold" style="display: none;">
                                        Manager: <span id="managerNameText"></span>
                                    </label>
                                </div> *@


                               @*  <div class="form-group">
                                    <label id="managerNameLabel" class="text-primary" style="display: none;">
                                        Manager: <span id="managerNameText" style="font-weight: 600;"></span>
                                    </label>
                                </div>
 *@


                                <div class="mb-4">
                                    <div class="form-check">
                                        <label class="form-check-label text-muted">
                                            <input type="checkbox" class="form-check-input" required>
                                            I agree to all Terms & Conditions
                                        </label>
                                    </div>
                                </div>

                                <div class="mt-3">
                                  @*   <button type="submit" class="btn btn-block btn-primary font-weight-medium auth-form-btn" style="font-size: 1.6rem; padding-top: 0.75rem; padding-bottom: 0.95rem;">
                                        Register
                                    </button> *@

                                    <button type="submit" class="btn btn-block btn-primary font-weight-medium auth-form-btn" ...>
                                        @submitButtonText
                                    </button>

                                </div>
                            }
                            <div class="mb-2 d-flex">
                                <button type="button" class="btn btn-facebook auth-form-btn flex-grow mr-1">
                                    <i class="fab fa-facebook-f mr-2"></i>Facebook
                                </button>
                                <button type="button" class="btn btn-google auth-form-btn flex-grow ml-1">
                                    <i class="fab fa-google mr-2"></i>Google
                                </button>
                            </div>

                            <div class="text-center mt-4 font-weight-light">
                                Already have an account? <a href="@Url.Action("Login", "Account")" class="text-primary">Login</a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6 register-half-bg d-flex flex-row">
                        <p class="text-white font-weight-medium text-center flex-grow align-self-end">Copyright &copy; 2030 All rights reserved.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="~/template2/vendors/js/vendor.bundle.base.js"></script>
    <script src="~/template2/vendors/js/vendor.bundle.addons.js"></script>
    <script src="~/template2/js/off-canvas.js"></script>
    <script src="~/template2/js/hoverable-collapse.js"></script>
    <script src="~/template2/js/misc.js"></script>
    <script src="~/template2/js/settings.js"></script>
    <script src="~/template2/js/todolist.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>

    <script>
        $(document).ready(function () {

            // ✅ 1. Prevent digits and special characters in First Name & Last Name
            $('#firstName, #lastName').on('input', function () {
                var value = $(this).val();
                $(this).val(value.replace(/[^a-zA-Z\s]/g, '')); // only letters and spaces
            });

            // ✅ 2. Allow only letters, digits, _ and in Email
            $('#emailField').on('keypress', function (e) {
               const allowedChars = /^[a-zA-Z0-9_@@.]$/;  // Razor इसे '@@' मानेगा, न कि Razor directive

                const key = String.fromCharCode(e.which);
                if (!allowedChars.test(key)) {
                    e.preventDefault(); // block other special characters
                }
            });

            // ✅ 3. Re-parse and trigger validation on keyup and blur
            $("form").removeData("validator");
            $("form").removeData("unobtrusiveValidation");

            $.validator.setDefaults({
                onkeyup: function (element) {
                    $(element).valid();
                },
                onfocusout: function (element) {
                    $(element).valid();
                }
            });

            $.validator.unobtrusive.parse("form");
        });
    </script>


    @* For Eye-Icon start  *@

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {

            // Initially hide both icons
            $("#open, #closed").hide();

            $("#txtPassword").on("input", function () {
                if ($(this).val().length > 0) {
                    $("#closed").show();
                    $("#open").hide();
                    $(this).attr("type", "password");
                } else {
                    $("#open, #closed").hide();
                    $(this).attr("type", "password");
                }
            });

            // Use 'mousedown' instead of 'click' for better responsiveness
            $("#closed").on("mousedown", function () {
                $(this).hide();
                $("#open").show();
                $("#txtPassword").attr("type", "text");
            });

            $("#open").on("mousedown", function () {
                $(this).hide();
                $("#closed").show();
                $("#txtPassword").attr("type", "password");
            });
        });
    </script>

    @* Eye js end here *@

    <script>
        $(document).ready(function () {
            $('#ManagerCode').on('input', function () {
                var code = $(this).val();
                if (code.length > 0) {
                    $.ajax({
                        url: '@Url.Action("GetManagerNameByCode", "Partner")',
                        type: 'GET',
                        data: { managerCode: code },
                        success: function (data) {
                            if (data) {
                                $('#managerNameText').text(data);
                                $('#managerNameLabel').show();
                            } else {
                                $('#managerNameText').text("");
                                $('#managerNameLabel').hide();
                            }
                        },
                        error: function () {
                            $('#managerNameText').text("");
                            $('#managerNameLabel').hide();
                        }
                    });
                } else {
                    $('#managerNameText').text("");
                    $('#managerNameLabel').hide();
                }
            });
        });
    </script>


</body>
</html>
